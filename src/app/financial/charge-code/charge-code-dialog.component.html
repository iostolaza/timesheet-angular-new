
<!-- src/app/financial/charge-codes-dialog.component.html -->

<div class="bg-white rounded-2xl shadow-xl p-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4" aria-label="Dialog title">
    {{ mode === 'create' ? 'Create Charge Code' : 'Select Charge Codes' }}
  </h2>
  <div *ngIf="errorMessage" class="text-red-500 text-sm mb-4" role="alert">{{ errorMessage }}</div>
  <ng-container *ngIf="mode === 'create'; else selectMode">
    <form [formGroup]="form" class="space-y-4" (ngSubmit)="save()">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Charge Code Name</label>
        <input
          type="text"
          formControlName="name"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
          placeholder="Enter charge code name"
          [attr.aria-required]="form.get('name')?.hasError('required')"
        />
        <div *ngIf="form.get('name')?.hasError('required') && form.get('name')?.touched" class="text-red-500 text-sm mt-1">Name is required</div>
        <div *ngIf="form.get('name')?.hasError('minlength') && form.get('name')?.touched" class="text-red-500 text-sm mt-1">Name must be at least 3 characters</div>
      </div>
      <div class="flex justify-end gap-3 mt-4">
        <button type="submit" mat-raised-button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md" [disabled]="form.invalid" aria-label="Save charge code">Save</button>
        <button type="button" mat-button class="border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-100" (click)="dialogRef.close()" aria-label="Cancel">Cancel</button>
      </div>
    </form>
  </ng-container>
  <ng-template #selectMode>
    <h3 class="text-lg font-semibold text-gray-800 mb-2" aria-label="Available Charge Codes">Available Charge Codes</h3>
    <div class="divide-y divide-gray-200">
      <div *ngFor="let code of availableCodes" class="py-2 flex items-center">
        <mat-checkbox class="mr-3" [(ngModel)]="code.active" [attr.aria-label]="'Select ' + code.name"></mat-checkbox>
        <span class="flex-1 text-gray-700">{{ code.name }} ({{ code.linkedAccount }})</span>
      </div>
    </div>
    <h3 class="mt-6 text-lg font-semibold text-gray-800 mb-2" aria-label="Active Charge Codes">Active Charge Codes</h3>
    <div class="divide-y divide-gray-200">
      <div *ngFor="let code of data.chargeCodes" class="py-2 flex items-center">
        <span class="flex-1 text-gray-700">{{ code.name }}</span>
        <button mat-icon-button class="text-red-500 hover:text-red-700" (click)="removeCode(code)" aria-label="Remove charge code">
          <mat-icon>remove</mat-icon>
        </button>
      </div>
    </div>
    <div class="mt-4 flex justify-end gap-3">
      <button mat-raised-button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md" (click)="save()" aria-label="Save selected charge codes">Save</button>
      <button mat-button class="border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-100" (click)="dialogRef.close()" aria-label="Cancel">Cancel</button>
    </div>
  </ng-template>
</div>